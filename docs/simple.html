<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–ª–µ—Å—è ‚Äî –ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –ø–æ –ö–æ–Ω—Å—Ç–∏—Ç—É—Ü–∏–∏ –†–µ—Å–ø—É–±–ª–∏–∫–∏ –ë–µ–ª–∞—Ä—É—Å—å</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .message { background: #f0f0f0; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .user { background: #007bff; color: white; }
        .assistant { background: #28a745; color: white; }
        input, button { padding: 10px; margin: 5px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .connected { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h1>–ê–ª–µ—Å—è ‚Äî –ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –ø–æ –ö–æ–Ω—Å—Ç–∏—Ç—É—Ü–∏–∏ –†–µ—Å–ø—É–±–ª–∏–∫–∏ –ë–µ–ª–∞—Ä—É—Å—å</h1>
    
    <div id="messages">
        <div class="message assistant">–ü—Ä–∏–≤–µ—Ç! –Ø –ê–ª–µ—Å—è, –≤–∞—à –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –ø–æ –ö–æ–Ω—Å—Ç–∏—Ç—É—Ü–∏–∏ –†–µ—Å–ø—É–±–ª–∏–∫–∏ –ë–µ–ª–∞—Ä—É—Å—å. –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?</div>
    </div>
    
    <div>
        <input type="text" id="messageInput" placeholder="–ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å –æ –ö–æ–Ω—Å—Ç–∏—Ç—É—Ü–∏–∏..." style="width: 60%;" />
        <button onclick="sendMessage()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        <button onclick="toggleVoiceMode()" id="voiceBtn">üé§ –ì–æ–ª–æ—Å–æ–≤–æ–π —Ä–µ–∂–∏–º</button>
    </div>
    
    <div id="status"></div>

    <script>
        const BACKEND_URL = 'https://web-production-9ed88.up.railway.app';
        let voiceMode = null;
        let isVoiceModeActive = false;

        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            addMessage('user', message);
            input.value = '';
            
            try {
                const response = await fetch(`${BACKEND_URL}/api/chat`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: message, session_id: 'default' })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                addMessage('assistant', data.response);
                
            } catch (error) {
                console.error('Error:', error);
                addMessage('assistant', '–ò–∑–≤–∏–Ω–∏—Ç–µ, –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.');
            }
        }

        async function toggleVoiceMode() {
            const voiceBtn = document.getElementById('voiceBtn');
            const status = document.getElementById('status');
            
            if (!isVoiceModeActive) {
                try {
                    status.textContent = '–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –≥–æ–ª–æ—Å–æ–≤–æ–º—É —Ä–µ–∂–∏–º—É...';
                    status.className = 'status';
                    
                    const response = await fetch(`${BACKEND_URL}/api/voice/realtime/session`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            voice: 'shimmer',
                            model: 'gpt-4o-realtime-preview-latest',
                            instructions: '–¢—ã –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –ø–æ –ö–æ–Ω—Å—Ç–∏—Ç—É—Ü–∏–∏ –†–µ—Å–ø—É–±–ª–∏–∫–∏ –ë–µ–ª–∞—Ä—É—Å—å. –û—Ç–≤–µ—á–∞–π —Ç–æ–ª—å–∫–æ –ø–æ –ö–æ–Ω—Å—Ç–∏—Ç—É—Ü–∏–∏ 2022 –≥–æ–¥–∞, –≤—Å–µ–≥–¥–∞ —É–∫–∞–∑—ã–≤–∞–π –Ω–æ–º–µ—Ä —Å—Ç–∞—Ç—å–∏. –ï—Å–ª–∏ –≤–æ–ø—Ä–æ—Å –Ω–µ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ –ö–æ–Ω—Å—Ç–∏—Ç—É—Ü–∏–∏ ‚Äî –≤–µ–∂–ª–∏–≤–æ –æ—Ç–∫–∞–∑—ã–≤–∞–π.'
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    console.log('Voice session created:', data);
                    
                    status.textContent = 'Voice Mode –ø–æ–¥–∫–ª—é—á–µ–Ω! –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –≥–æ–≤–æ—Ä–∏—Ç—å —Å –ê–ª–µ—Å–µ–π.';
                    status.className = 'status connected';
                    voiceBtn.textContent = 'üî¥ –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≥–æ–ª–æ—Å–æ–≤–æ–π —Ä–µ–∂–∏–º';
                    isVoiceModeActive = true;
                    
                } catch (error) {
                    console.error('Voice mode connection failed:', error);
                    status.textContent = `Voice mode connection failed: ${error.message}`;
                    status.className = 'status error';
                }
            } else {
                status.textContent = 'Voice Mode –æ—Ç–∫–ª—é—á–µ–Ω.';
                status.className = 'status';
                voiceBtn.textContent = 'üé§ –ì–æ–ª–æ—Å–æ–≤–æ–π —Ä–µ–∂–∏–º';
                isVoiceModeActive = false;
            }
        }

        function addMessage(sender, text) {
            const messages = document.getElementById('messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            messageDiv.textContent = text;
            messages.appendChild(messageDiv);
            messages.scrollTop = messages.scrollHeight;
        }

        document.getElementById('messageInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
    </script>
</body>
</html>
